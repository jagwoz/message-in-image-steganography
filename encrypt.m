image = imread('image.bmp');
red = image(:, :, 1);

%secret = '!@#$%^&*()Lorem ipsum dolor sisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Utdignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra sectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissisectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissi sectetur adipiscing elit. Nulla ultricies fermentum laoreet. Vivamus ornare tellus a elit porttitor rutrum. Ut eget neque id felis faucibus suscipit. Quisque tempus pharetra velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissi velit vitae interdum. Morbi hendrerit nulla eu eros auctor, non dignissim nulla congue. Sed lobortis nibh leo, eget porttitor felis convallis ac. Maecenas finibus sagittis ornare. Integer nec orci dignissim, facilisis elit venenatis, rutrum mi.Aenean porttitor rutrum libero, sit amet sollicitudin velit volutpat ut. Morbi vel luctus tortor, sit amet cursus dolor. Duis convallis tempor sagittis. Donec sodales blandit ipsum, in dapibus orci lacinia eu. Donec lacinia sollicitudin libero, vitae sodales arcu bibendum quis. Curabitur fermentum ac ipsum ut pulvinar. Aenean non nisi id augue gravida pulvinar non at magna. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Nunc ultrices sit amet enim et venenatis. In neque nulla, porta in ultrices a, vestibulum id arcu. Ut sollicitudin aliquet tellus a sagittis. Vivamus mattis lacus sagittis lobortis malesuada.Etiam euismod massa turpis, quis auctor odio efficitur pretium. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Integer vel felis libero. Sed elementum est nec enim accumsan, ut consequat urna tempor. Donec lacinia ante dui, at euismod felis facilisis in. Mauris id nulla eleifend, sollicitudin mi quis, congue nunc. In semper malesuada ipsum a feugiat. Nulla gravida porta hendrerit.Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Vivamus eleifend dignissim enim in maximus. Quisque luctus libero in urna semper, vel luctus nibh maximus. Phasellus pellentesque, dolor et elementum molestie, est neque pretium leo, id molestie nibh elit id dolor. Duis egestas erat ut massa gravida sollicitudin. Maecenas elementum est lectus, sed fringilla libero lacinia vitae. In imperdiet mattis magna et imperdiet. Pellentesque vulputate venenatis ex, in dictum ex feugiat vitae.Phasellus vitae ipsum massa. Sed ultricies, arcu non molestie tempor, diam libero bibendum nisi, et gravida erat tellus at nisi. Sed eget lobortis sem, ut mattis ipsum. Sed a est mi. Suspendisse pulvinar augue ac augue fermentum, sit amet cursus est gravida. Ut luctus sapien sed nulla maximus, nec tincidunt libero fermentum. Morbi eu tortor ac elit auctor scelerisque eget eget tellus. Ut nunc nisi, faucibus ut sodales vitae, fermentum non nibh. Suspendisse molestie eros consequat sem molestie convallis. Praesent ornare suscipit rutrum. Aliquam faucibus commodo aliquam. Quisque suscipit, orci id convallis lobortis, nisi velit lobortis est, ac pellentesque tellus ante nec lorem.Nam a urna eu odio porta bibendum vitae quis mi. Pellentesque elementum, nisl et egestas fermentum, lacus metus molestie nisi, id finibus felis quam sed elit. Cras eu justo convallis turpis rutrum facilisis. Sed sollicitudin ante eu magna congue accumsan. Aliquam efficitur porta nisl quis molestie. In imperdiet lacinia tortor. Suspendisse consectetur justo risus, eget dignissim justo volutpat at. Vestibulum lobortis rutrum ligula ut porta. Aliquam est risus, tempor at ultrices nec, laoreet ut diam. Aliquam eu enim semper, tempor lectus sit amet, condimentum lorem.Nullam rutrum arcu at diam condimentum euismod. Mauris convallis ipsum ut nisi ultrices accumsan. Morbi mollis leo non scelerisque feugiat. Maecenas mauris lorem, aliquet in dolor in, egestas vestibulum velit. Mauris eget tortor vehicula, venenatis eros quis, tincidunt massa. Cras vitae placerat est, eu vulputate nisl. Aenean egestas euismod aliquam. Ut rhoncus urna tellus, quis facilisis libero vestibulum sed. Aenean facilisis turpis in purus tempus, non faucibus enim luctusPraesent eu congue risus. Vestibulum rhoncus est eget lectus imperdiet, nec egestas neque aliquet. Nulla diam quam, fermentum a felis sit amet, dignissim faucibus justo. Aliquam arcu arcu, tincidunt ac porta vitae, mollis vel purus. Aenean mi massa, pharetra non fringilla in, gravida eget massa. Interdum et malesuada fames ac ante ipsum primis in faucibus. Duis eleifend laoreet massa, cursus condimentum lectus consequat ac. Ut sodales nunc turpis, sit amet ornare quam efficitur sit amet. Donec vel fermentum lectus, ullamcorper lacinia urnaNullam congue mattis enim sed luctus. Cras lobortis vel orci id venenatis. Nunc sem sem, molestie a ullamcorper ultrices, auctor nec sem. Nulla eu fermentum nulla. Aliquam ligula nunc, varius non felis nec, luctus lacinia tellus. Ut convallis dignissim nulla, et eleifend neque accumsan non. Nunc metus felis, dictum a laoreet a, scelerisque ac tortor.Donec at ante justo. Mauris ullamcorper dapibus nulla, non auctor velit commodo vitae. Vivamus a porttitor enim. Maecenas quis congue justo. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Duis quis elementum erat. Ut ullamcorper eget massa sit amet porttitor. Maecenas luctus diam quis erat sagittis lobortis. Nulla in elit sit amet sem vehicula eleifend. Maecenas ut massa non urna facilisis tristique eget ut dolor. Proin condimentum placerat nunc a commodo. In gravida cursus lectus, dignissim volutpat libero fringilla in.Maecenas aliquet molestie enim. Phasellus velit ex, mattis a tempus ac, dignissim dignissim dolor. Pellentesque a nunc vulputate, volutpat risus a, viverra libero. Sed feugiat consequat hendrerit. Vivamus a imperdiet risus. Sed eget mauris tempor, consectetur urna vitae, tristique enim. Sed vel elit lobortis, varius sapien vitae, suscipit risus. Curabitur vestibulum dui quis interdum congue. Duis vehicula eros mattis eleifend viverra. Nulla accumsan ac justo vel imperdiet. Aenean sagittis faucibus condimentum. Sed sed euismod nulla. Integer in aliquam augue. Mauris pharetra nulla eget diam elementum porta. Sed at tortor turpis.Sed eleifend, turpis eu posuere semper, diam quam mollis justo, in posuere lorem sem eu nulla. Cras nec lacinia justo. Donec dapibus egestas nisl, a efficitur lectus tempor id. Phasellus ac nunc lacinia, eleifend nisl at, pretium leo. Proin finibus orci urna. In dignissim posuere leo et pellentesque. Etiam nec ipsum elit. Mauris molestie turpis ante, et tincidunt leo sagittis sit amet. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Morbi suscipit felis mauris, id mollis augue mollis quis. Praesent in faucibus nulla. Sed sed augue a neque vestibulum semper. Nunc eget iaculis nisl. Nunc eleifend, neque in placerat iaculis, velit felis sagittis arcu, id elementum neque leo ac felis. Integer vel blandit ligula, ut vehicula est. Etiam et ex lacus.Phasellus eu aliquet libero, quis dignissim quam. Proin dapibus velit quis facilisis egestas. Etiam accumsan justo iaculis nisl bibendum tempus. Nulla mattis sit amet nisi et consectetur. Pellentesque consectetur eleifend ultrices. Vestibulum ut elit et ligula pulvinar iaculis. Cras maximus porta eros at feugiat. Duis nec nibh nisi. Maecenas dapibus arcu sagittis sem efficitur vulputate. Cras volutpat arcu sit amet cursus fermentum. Nullam enim mauris, posuere nec mi at, egestas eleifend velit. Aenean et fermentum ligula. Maecenas facilisis vehicula ex, eu tempus magna molestie vitae.Nulla ac arcu id ipsum laoreet varius at quis arcu. Nulla vel nisl commodo, lacinia mauris in, euismod lacus. Aenean pretium elementum elementum. Suspendisse dolor felis, facilisis quis diam ut, pulvinar imperdiet tortor. Aliquam quis ornare risus. Nulla blandit lacinia arcu id scelerisque. Quisque euismod, eros nec varius bibendum, nulla urna consectetur nibh, eu tincidunt nisl velit pretium sem. Etiam eget lacus in nisl tristique convallis. Vivamus et eros et libero pharetra maximus a et leo. Donec ac congue libero. In tempor eros vitae faucibus finibus. Curabitur eu nisl ac ante pharetra laoreet sit amet eget lacus. Vestibulum non metus sit amet dui molestie semper vitae lobortis lacus. Donec feugiat lectus vel tempus pulvinar. Maecenas tincidunt dolor ante, et elementum dui sodales quis. Proin id magna sit amet nulla porttitor ultrices at vitae sapien.Cras efficitur dapibus est id convallis. Nunc aliquet molestie neque ut convallis. Donec mollis sem mi, vel interdum orci blandit vitae. Donec interdum eros a sapien congue, vitae condimentum nisi egestas. Donec lacinia mollis magna, vel vulputate ante rutrum non. Integer nec dolor ac purus tristique lobortis aliquet ac velit. Cras iaculis condimentum eros at porttitor. Etiam nisi massa, aliquam eget mi in, ultrices efficitur libero. Nullam auctor risus quis erat ultrices, id pulvinar quam porttitor. Suspendisse potenti.Vestibulum vel placerat orci. Praesent fringilla pretium vulputate. Proin nec lorem viverra, porttitor nisl ut, tincidunt eros. Phasellus rutrum, arcu eget posuere mattis, sapien nunc ornare diam, scelerisque posuere ex libero vel felis. Nam porta erat mi, et pharetra eros porttitor eget. Etiam posuere molestie mauris id gravida. Vivamus eu metus posuere, volutpat sapien eget, placerat lorem. Integer vehicula ex vel lacus facilisis cursus. Cras gravida mauris dolor.Phasellus sagittis purus id neque facilisis varius. Donec in dolor nec leo ultricies ultricies. Mauris scelerisque ex ut massa efficitur, quis vehicula justo finibus. Donec sagittis metus nisi, nec vulputate arcu porttitor blandit. Nullam fringilla nulla sed neque tristique varius. Nulla euismod sem sit amet tempus pellentesque. Donec malesuada laoreet placerat. Nulla sed augue eu felis malesuada suscipit eget vitae ipsum. Nam ac molestie tellus. Nam at nisl rhoncus, tincidunt velit sit amet, lacinia sapien.Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quis lorem eget enim venenatis condimentum. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Aliquam erat volutpat. Aenean dolor lorem, semper ut ante vel, hendrerit tincidunt nisi. Aliquam erat aliquam.';
%key = '%!*%@!$%!%$%!@$%!@%$!@%$    U!U!@I!U@I!@IU@!IU!IU@!IU@I!@H!J@JG!@VHGJ!HG@HJVJGHCDHSDHsdsghgasdhgadgshasg*%!%@& !&%@*%&! @&%!*&!()(@*)(!*(@) *!@*((*!@(*!@( !#$!%$^@^@%&@&%!&*!^*^@*@*^@(*(&@(@';

secret = input('secret: ','s');
key = input('key: ','s');

rng(sum(double(key)))

delimitter = reshape(dec2bin(key, 8).'-'0',1,[]);
secretBin = reshape(dec2bin(secret, 8).'-'0',1,[]);
secretBin = [secretBin, delimitter, delimitter, delimitter];

[numRowsPixels, numColsPixels] = size(red);
fullImage =  red(1, :);
for i = 2 : numRowsPixels, fullImage = [fullImage, red(i, :)]; end

keyFill = [];
for i = 1 : length(fullImage)
    if (rand(1,1) <= rand(1,1)), keyFill = [keyFill, 1];
    else keyFill = [keyFill, 0]; end
end

messageSize = length(secretBin);
disp(['Message size: ', num2str(messageSize)])

spaceSize = sum(keyFill);
codeNumber = 1;
if (spaceSize <= length(fullImage)/2), spaceSize = length(fullImage) - spaceSize; codeNumber = 0; end
disp(['Space size: ', num2str(spaceSize)])

if (spaceSize < messageSize), disp('Too little space'); return; end

firstIndex = sum(double(key));
disp(['First index: ', num2str(firstIndex)])

redBin = de2bi(fullImage(1, firstIndex), 8);
redBin(1) = codeNumber;
fullImage(1, firstIndex) = bi2de(redBin);

iterator = firstIndex + 1;
iteratorMessage = 1;
while (messageSize >= iteratorMessage)
    if (keyFill(1, iterator) == codeNumber)
        redBin = de2bi(fullImage(1, iterator), 8);
        redBin(1) = secretBin(iteratorMessage);
        fullImage(1, iterator) = bi2de(redBin);
        iteratorMessage = iteratorMessage + 1;
    end
    iterator = iterator + 1;
    if (iterator > length(fullImage)), iterator = 1; end
end

j = 1;
for i = 0 : numColsPixels : length(fullImage) - 1
    red(j, :) = fullImage(i + 1 : i + numColsPixels);
    j = j + 1;
end

image(:, :, 1) = red;
imwrite(image, 'image_with_secret.bmp');
disp('Image saved as image_with_secret.bmp')
clear